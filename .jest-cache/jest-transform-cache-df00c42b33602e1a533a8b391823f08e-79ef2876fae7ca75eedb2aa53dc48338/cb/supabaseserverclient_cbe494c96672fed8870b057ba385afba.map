{"version":3,"names":["createClient","cov_qa4wkjqni","f","s","createServerActionClient","createServerComponentClient","default","_default","assertServerEnvironment","window","b","Error","process","createSafeCookieStore","cookies","Promise","resolve","then","_interop_require_wildcard","require","cookieStore","get","name","cookie","value","error","undefined","set","options","remove","delete","_react","cache","_ssr","createServerClient","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","NODE_ENV","console","warn"],"sources":["/Users/cheolhyun/Repositories/picnic-web/utils/supabase-server-client.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cache } from \"react\";\nimport type { CookieOptions } from \"@supabase/ssr\";\n\n/**\n * 서버 환경 체크 - 엄격한 검증\n */\nfunction assertServerEnvironment() {\n  if (typeof window !== \"undefined\") {\n    throw new Error(\n      \"createClient는 서버 환경에서만 호출해야 합니다. 클라이언트에서는 createClientComponentClient를 사용하세요.\",\n    );\n  }\n  \n  if (typeof process === \"undefined\") {\n    throw new Error(\"서버 환경이 아닙니다. process 객체를 찾을 수 없습니다.\");\n  }\n}\n\n/**\n * 안전한 쿠키 스토어 생성 함수\n */\nasync function createSafeCookieStore() {\n  try {\n    // Dynamic import로만 next/headers 로드\n    const { cookies } = await import(\"next/headers\");\n    \n    // Next.js 15에서는 반드시 async 함수 내에서 호출\n    const cookieStore = await cookies();\n    \n    return {\n      get: (name: string) => {\n        try {\n          const cookie = cookieStore.get(name);\n          return cookie?.value;\n        } catch (error) {\n          // Request scope 밖에서 호출된 경우 undefined 반환\n          return undefined;\n        }\n      },\n      set: (name: string, value: string, options?: CookieOptions) => {\n        try {\n          cookieStore.set(name, value, options);\n        } catch (error) {\n          // Request scope 밖에서는 무시\n        }\n      },\n      remove: (name: string, options?: CookieOptions) => {\n        try {\n          cookieStore.delete(name);\n        } catch (error) {\n          // Request scope 밖에서는 무시\n        }\n      },\n    };\n  } catch (error) {\n    // next/headers를 사용할 수 없는 환경에서는 빈 구현 반환\n    return {\n      get: () => undefined,\n      set: () => {},\n      remove: () => {},\n    };\n  }\n}\n\n/**\n * 서버 컴포넌트에서만 사용할 수 있는 Supabase 클라이언트 생성\n * Next.js 15 App Router 환경에서 안전하게 cookies 사용\n */\nexport const createClient = cache(async () => {\n  assertServerEnvironment();\n\n  const cookieStore = await createSafeCookieStore();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return cookieStore.get(name);\n        },\n        set(name: string, value: string, options: CookieOptions) {\n          cookieStore.set(name, value, options);\n        },\n        remove(name: string, options: CookieOptions) {\n          cookieStore.remove(name, options);\n        },\n      },\n    },\n  );\n});\n\nexport default createClient;\n\n/**\n * 서버 액션에서 사용할 수 있는 Supabase 클라이언트\n */\nexport async function createServerActionClient() {\n  assertServerEnvironment();\n  \n  try {\n    const { cookies } = await import(\"next/headers\");\n    const cookieStore = await cookies();\n\n    return createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          get(name: string) {\n            return cookieStore.get(name)?.value;\n          },\n          set(name: string, value: string, options: CookieOptions) {\n            cookieStore.set(name, value, options);\n          },\n          remove(name: string, options: CookieOptions) {\n            cookieStore.delete(name);\n          },\n        },\n      },\n    );\n  } catch (error) {\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(\"서버 액션에서 next/headers 사용 불가능:\", error);\n    }\n    \n    return createServerClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n      {\n        cookies: {\n          get: () => undefined,\n          set: () => {},\n          remove: () => {},\n        },\n      },\n    );\n  }\n}\n\n// 호환성을 위한 deprecated 별칭\nexport const createServerComponentClient = createClient; "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}