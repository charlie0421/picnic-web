{"version":3,"names":["OPTIONS","cov_1s23pk6n3v","f","s","POST","PUT","requestCounts","Map","RATE_LIMIT_WINDOW","RATE_LIMIT_MAX_REQUESTS","checkRateLimit","clientId","now","Date","clientData","get","b","resetTime","set","count","allowed","remaining","validateInput","code","state","valid","error","length","test","handleWeChatApiError","errcode","errmsg","errorCode","toString","errorMessages","setSecurityHeaders","response","headers","process","env","NEXT_PUBLIC_SITE_URL","request","startTime","clientIp","console","log","ip","userAgent","timestamp","toISOString","rateLimitResult","warn","_server","NextResponse","json","retryAfter","Math","ceil","status","requestBody","parseError","validation","appId","NEXT_PUBLIC_WECHAT_APP_ID","appSecret","WECHAT_APP_SECRET","supabase","_supabasejs","createClient","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","auth","autoRefreshToken","persistSession","supabaseError","tokenUrl","encodeURIComponent","tokenResponse","fetch","method","signal","AbortSignal","timeout","fetchError","ok","statusText","details","tokenData","errorMessage","friendlyMessage","accessToken","access_token","openId","openid","refreshToken","refresh_token","expiresIn","expires_in","hasAccessToken","hasOpenId","userInfoUrl","userInfoResponse","userInfo","normalizedProfile","_wechat","normalizeWeChatProfile","profileError","idToken","generateJwtToken","sub","id","name","picture","avatar","provider","wechat_openid","jwtError","data","existingUsers","from","select","eq","userId","update","display_name","avatar_url","updated_at","processingTime","substring","success","tokens","id_token","profile","metadata","Error","message","String","stack","undefined","refreshUrl","refreshResponse","refreshData","hasNewToken","payload","jwtSecret","JWT_SECRET","SUPABASE_JWT_SECRET","NEXT_PUBLIC_SUPABASE_ANON_KEY","floor","tokenPayload","iat","exp","iss","aud","jti","random","_jsonwebtoken","default","sign","algorithm"],"sources":["/Users/cheolhyun/Repositories/picnic-web/app/api/auth/wechat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\nimport { Database } from '@/types/supabase';\nimport { SocialAuthError, SocialAuthErrorCode } from '@/lib/supabase/social/types';\nimport { normalizeWeChatProfile } from '@/lib/supabase/social/wechat';\nimport jwt from 'jsonwebtoken';\n\n// ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…ì„ ìœ„í•œ ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ì €ì¥ì†Œ\nconst requestCounts = new Map<string, { count: number; resetTime: number }>();\nconst RATE_LIMIT_WINDOW = 15 * 60 * 1000; // 15ë¶„\nconst RATE_LIMIT_MAX_REQUESTS = 10; // 15ë¶„ë‹¹ ìµœëŒ€ 10íšŒ ìš”ì²­\n\n/**\n * ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… ê²€ì‚¬\n * \n * @param clientId í´ë¼ì´ì–¸íŠ¸ ì‹ë³„ì (IP ì£¼ì†Œ ë“±)\n * @returns ìš”ì²­ í—ˆìš© ì—¬ë¶€\n */\nfunction checkRateLimit(clientId: string): { allowed: boolean; remaining: number; resetTime: number } {\n  const now = Date.now();\n  const clientData = requestCounts.get(clientId);\n  \n  // ê¸°ì¡´ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ìœˆë„ìš°ê°€ ë§Œë£Œëœ ê²½ìš°\n  if (!clientData || now > clientData.resetTime) {\n    const resetTime = now + RATE_LIMIT_WINDOW;\n    requestCounts.set(clientId, { count: 1, resetTime });\n    return { allowed: true, remaining: RATE_LIMIT_MAX_REQUESTS - 1, resetTime };\n  }\n  \n  // ìš”ì²­ íšŸìˆ˜ ì¦ê°€\n  clientData.count++;\n  \n  if (clientData.count > RATE_LIMIT_MAX_REQUESTS) {\n    return { allowed: false, remaining: 0, resetTime: clientData.resetTime };\n  }\n  \n  return { \n    allowed: true, \n    remaining: RATE_LIMIT_MAX_REQUESTS - clientData.count, \n    resetTime: clientData.resetTime \n  };\n}\n\n/**\n * ì…ë ¥ ê²€ì¦ í•¨ìˆ˜\n * \n * @param code OAuth ì½”ë“œ\n * @param state ìƒíƒœ í† í°\n * @returns ê²€ì¦ ê²°ê³¼\n */\nfunction validateInput(code: string, state?: string): { valid: boolean; error?: string } {\n  // ì½”ë“œ ê²€ì¦\n  if (!code || typeof code !== 'string') {\n    return { valid: false, error: 'OAuth ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.' };\n  }\n  \n  if (code.length < 10 || code.length > 512) {\n    return { valid: false, error: 'ìœ íš¨í•˜ì§€ ì•Šì€ OAuth ì½”ë“œ í˜•ì‹ì…ë‹ˆë‹¤.' };\n  }\n  \n  // ì½”ë“œì— í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ ìˆëŠ”ì§€ í™•ì¸\n  if (!/^[a-zA-Z0-9_-]+$/.test(code)) {\n    return { valid: false, error: 'OAuth ì½”ë“œì— ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' };\n  }\n  \n  // ìƒíƒœ í† í° ê²€ì¦ (ì„ íƒì‚¬í•­)\n  if (state && typeof state === 'string') {\n    if (state.length > 256) {\n      return { valid: false, error: 'ìƒíƒœ í† í°ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤.' };\n    }\n    \n    if (!/^[a-zA-Z0-9_-]+$/.test(state)) {\n      return { valid: false, error: 'ìƒíƒœ í† í°ì— ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' };\n    }\n  }\n  \n  return { valid: true };\n}\n\n/**\n * WeChat API ì˜¤ë¥˜ ì½”ë“œ ì²˜ë¦¬\n * \n * @param errcode WeChat API ì˜¤ë¥˜ ì½”ë“œ\n * @param errmsg WeChat API ì˜¤ë¥˜ ë©”ì‹œì§€\n * @returns ì‚¬ìš©ì ì¹œí™”ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€\n */\nfunction handleWeChatApiError(errcode: string | number, errmsg: string): string {\n  const errorCode = errcode.toString();\n  \n  const errorMessages: Record<string, string> = {\n    // í† í° ê´€ë ¨ ì˜¤ë¥˜\n    '40001': 'ì•¡ì„¸ìŠ¤ í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',\n    '40002': 'ì˜ëª»ëœ ìê²© ì¦ëª… íƒ€ì…ì…ë‹ˆë‹¤.',\n    '40003': 'OpenIDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',\n    '40013': 'ì˜ëª»ëœ ì•± IDì…ë‹ˆë‹¤.',\n    '40125': 'ì˜ëª»ëœ ì•± ì‹œí¬ë¦¿ì…ë‹ˆë‹¤.',\n    \n    // ì½”ë“œ ê´€ë ¨ ì˜¤ë¥˜\n    '40029': 'ì˜ëª»ëœ OAuth ì½”ë“œì…ë‹ˆë‹¤.',\n    '40163': 'ì½”ë“œê°€ ì´ë¯¸ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.',\n    \n    // í† í° ë§Œë£Œ ì˜¤ë¥˜\n    '42001': 'ì•¡ì„¸ìŠ¤ í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n    '42002': 'ë¦¬í”„ë ˆì‹œ í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n    '42003': 'ì•¡ì„¸ìŠ¤ í† í°ì´ ê°±ì‹ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.',\n    \n    // ê¶Œí•œ ê´€ë ¨ ì˜¤ë¥˜\n    '48001': 'ì•±ì´ ìŠ¹ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',\n    '48002': 'ì•±ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.',\n    '48003': 'ì•±ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.',\n    '48004': 'ì•±ì´ ì¼ì‹œ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.',\n    \n    // ì‚¬ìš©ì ê´€ë ¨ ì˜¤ë¥˜\n    '50001': 'ì‚¬ìš©ìê°€ ì¸ì¦ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.',\n    '50002': 'ì‚¬ìš©ìê°€ ì•± ì‚¬ìš©ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.',\n    \n    // ì‹œìŠ¤í…œ ì˜¤ë¥˜\n    '-1': 'WeChat ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',\n    '40164': 'ìš”ì²­ì´ ë„ˆë¬´ ìì£¼ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',\n    '89503': 'WeChat ì„œë¹„ìŠ¤ê°€ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',\n  };\n  \n  return errorMessages[errorCode] || `WeChat API ì˜¤ë¥˜: ${errmsg} (ì½”ë“œ: ${errcode})`;\n}\n\n/**\n * ë³´ì•ˆ í—¤ë” ì„¤ì •\n * \n * @param response NextResponse ê°ì²´\n * @returns ë³´ì•ˆ í—¤ë”ê°€ ì„¤ì •ëœ ì‘ë‹µ\n */\nfunction setSecurityHeaders(response: NextResponse): NextResponse {\n  // CORS í—¤ë”\n  response.headers.set('Access-Control-Allow-Origin', process.env.NEXT_PUBLIC_SITE_URL || '*');\n  response.headers.set('Access-Control-Allow-Methods', 'POST, PUT, OPTIONS');\n  response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n  \n  // ë³´ì•ˆ í—¤ë”\n  response.headers.set('X-Content-Type-Options', 'nosniff');\n  response.headers.set('X-Frame-Options', 'DENY');\n  response.headers.set('X-XSS-Protection', '1; mode=block');\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n  \n  // ìºì‹œ ë°©ì§€ (ë¯¼ê°í•œ ë°ì´í„°)\n  response.headers.set('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n  response.headers.set('Pragma', 'no-cache');\n  response.headers.set('Expires', '0');\n  \n  return response;\n}\n\n/**\n * WeChat í† í° ë° ì‚¬ìš©ì ì •ë³´ ì²˜ë¦¬ API\n * \n * ì´ APIëŠ” WeChat OAuth ì½œë°±ìœ¼ë¡œë¶€í„° ë°›ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬\n * ì•¡ì„¸ìŠ¤ í† í°ì„ íšë“í•˜ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\n */\nexport async function POST(request: NextRequest) {\n  const startTime = Date.now();\n  \n  try {\n    // í´ë¼ì´ì–¸íŠ¸ IP ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° (ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…ìš©)\n    const clientIp = request.headers.get('x-forwarded-for') || \n                     request.headers.get('x-real-ip') || \n                     'unknown';\n    \n    console.log('ğŸ” WeChat API ìš”ì²­ ì‹œì‘:', {\n      ip: clientIp,\n      userAgent: request.headers.get('user-agent'),\n      timestamp: new Date().toISOString()\n    });\n    \n    // ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… ê²€ì‚¬\n    const rateLimitResult = checkRateLimit(clientIp);\n    if (!rateLimitResult.allowed) {\n      console.warn('âš ï¸ ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ì´ˆê³¼:', {\n        ip: clientIp,\n        resetTime: new Date(rateLimitResult.resetTime).toISOString()\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: 'ìš”ì²­ì´ ë„ˆë¬´ ìì£¼ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',\n          retryAfter: Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000)\n        },\n        { status: 429 }\n      );\n      \n      response.headers.set('Retry-After', Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000).toString());\n      response.headers.set('X-RateLimit-Limit', RATE_LIMIT_MAX_REQUESTS.toString());\n      response.headers.set('X-RateLimit-Remaining', '0');\n      response.headers.set('X-RateLimit-Reset', rateLimitResult.resetTime.toString());\n      \n      return setSecurityHeaders(response);\n    }\n    \n    // ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±\n    let requestBody;\n    try {\n      requestBody = await request.json();\n    } catch (parseError) {\n      console.error('âŒ ìš”ì²­ ë³¸ë¬¸ íŒŒì‹± ì˜¤ë¥˜:', parseError);\n      const response = NextResponse.json(\n        { error: 'ì˜ëª»ëœ JSON í˜•ì‹ì…ë‹ˆë‹¤.' },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    const { code, state } = requestBody;\n    \n    // ì…ë ¥ ê²€ì¦\n    const validation = validateInput(code, state);\n    if (!validation.valid) {\n      console.warn('âš ï¸ ì…ë ¥ ê²€ì¦ ì‹¤íŒ¨:', validation.error);\n      const response = NextResponse.json(\n        { error: validation.error },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // í™˜ê²½ ë³€ìˆ˜ ê²€ì¦\n    const appId = process.env.NEXT_PUBLIC_WECHAT_APP_ID;\n    const appSecret = process.env.WECHAT_APP_SECRET;\n    \n    if (!appId || !appSecret) {\n      console.error('âŒ WeChat í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½');\n      const response = NextResponse.json(\n        { error: 'WeChat ì„œë¹„ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' },\n        { status: 500 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±\n    let supabase;\n    try {\n      supabase = createClient<Database>(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.SUPABASE_SERVICE_ROLE_KEY!,\n        {\n          auth: {\n            autoRefreshToken: false,\n            persistSession: false,\n          }\n        }\n      );\n    } catch (supabaseError) {\n      console.error('âŒ Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì‹¤íŒ¨:', supabaseError);\n      const response = NextResponse.json(\n        { error: 'ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' },\n        { status: 500 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    console.log('ğŸ” WeChat ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­ ì‹œì‘');\n    \n    // 1. ì½”ë“œë¡œ ì•¡ì„¸ìŠ¤ í† í° íšë“\n    const tokenUrl = `https://api.weixin.qq.com/sns/oauth2/access_token?appid=${encodeURIComponent(appId)}&secret=${encodeURIComponent(appSecret)}&code=${encodeURIComponent(code)}&grant_type=authorization_code`;\n    \n    let tokenResponse;\n    try {\n      tokenResponse = await fetch(tokenUrl, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n          'User-Agent': 'WeChat-OAuth-Server/1.0'\n        },\n        // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)\n        signal: AbortSignal.timeout(10000)\n      });\n    } catch (fetchError) {\n      console.error('âŒ WeChat í† í° ìš”ì²­ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', fetchError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' },\n        { status: 503 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    if (!tokenResponse.ok) {\n      console.error('âŒ WeChat í† í° ìš”ì²­ HTTP ì˜¤ë¥˜:', {\n        status: tokenResponse.status,\n        statusText: tokenResponse.statusText\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: 'WeChat í† í° ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',\n          details: `HTTP ${tokenResponse.status}: ${tokenResponse.statusText}`\n        },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    let tokenData;\n    try {\n      tokenData = await tokenResponse.json();\n    } catch (parseError) {\n      console.error('âŒ WeChat í† í° ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜:', parseError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // WeChat API ì˜¤ë¥˜ ì²˜ë¦¬\n    if (tokenData.errcode) {\n      const errorMessage = handleWeChatApiError(tokenData.errcode, tokenData.errmsg);\n      console.error('âŒ WeChat í† í° API ì˜¤ë¥˜:', {\n        errcode: tokenData.errcode,\n        errmsg: tokenData.errmsg,\n        friendlyMessage: errorMessage\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: errorMessage,\n          code: tokenData.errcode \n        },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    const accessToken = tokenData.access_token;\n    const openId = tokenData.openid;\n    const refreshToken = tokenData.refresh_token;\n    const expiresIn = tokenData.expires_in;\n    \n    if (!accessToken || !openId) {\n      console.error('âŒ WeChat í† í° ì‘ë‹µì— í•„ìˆ˜ í•„ë“œ ëˆ„ë½:', {\n        hasAccessToken: !!accessToken,\n        hasOpenId: !!openId\n      });\n      \n      const response = NextResponse.json(\n        { error: 'WeChatì—ì„œ ìœ íš¨í•˜ì§€ ì•Šì€ í† í° ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤.' },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    console.log('âœ… WeChat ì•¡ì„¸ìŠ¤ í† í° íšë“ ì™„ë£Œ');\n    console.log('ğŸ” WeChat ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹œì‘');\n    \n    // 2. ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°\n    const userInfoUrl = `https://api.weixin.qq.com/sns/userinfo?access_token=${encodeURIComponent(accessToken)}&openid=${encodeURIComponent(openId)}&lang=zh_CN`;\n    \n    let userInfoResponse;\n    try {\n      userInfoResponse = await fetch(userInfoUrl, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n          'User-Agent': 'WeChat-OAuth-Server/1.0'\n        },\n        // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)\n        signal: AbortSignal.timeout(10000)\n      });\n    } catch (fetchError) {\n      console.error('âŒ WeChat ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', fetchError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' },\n        { status: 503 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    if (!userInfoResponse.ok) {\n      console.error('âŒ WeChat ì‚¬ìš©ì ì •ë³´ ìš”ì²­ HTTP ì˜¤ë¥˜:', {\n        status: userInfoResponse.status,\n        statusText: userInfoResponse.statusText\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: 'WeChat ì‚¬ìš©ì ì •ë³´ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',\n          details: `HTTP ${userInfoResponse.status}: ${userInfoResponse.statusText}`\n        },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    let userInfo;\n    try {\n      userInfo = await userInfoResponse.json();\n    } catch (parseError) {\n      console.error('âŒ WeChat ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜:', parseError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì‚¬ìš©ì ì •ë³´ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // WeChat API ì˜¤ë¥˜ ì²˜ë¦¬\n    if (userInfo.errcode) {\n      const errorMessage = handleWeChatApiError(userInfo.errcode, userInfo.errmsg);\n      console.error('âŒ WeChat ì‚¬ìš©ì ì •ë³´ API ì˜¤ë¥˜:', {\n        errcode: userInfo.errcode,\n        errmsg: userInfo.errmsg,\n        friendlyMessage: errorMessage\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: errorMessage,\n          code: userInfo.errcode \n        },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    console.log('âœ… WeChat ì‚¬ìš©ì ì •ë³´ íšë“ ì™„ë£Œ');\n    \n    // í”„ë¡œí•„ ì •ë³´ ì •ê·œí™”\n    let normalizedProfile;\n    try {\n      normalizedProfile = normalizeWeChatProfile(userInfo);\n    } catch (profileError) {\n      console.error('âŒ WeChat í”„ë¡œí•„ ì •ê·œí™” ì˜¤ë¥˜:', profileError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì‚¬ìš©ì ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },\n        { status: 500 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // 3. JWT í† í° ìƒì„± (Supabase ì¸ì¦ìš©)\n    let idToken;\n    try {\n      idToken = await generateJwtToken({\n        sub: normalizedProfile.id,\n        name: normalizedProfile.name,\n        picture: normalizedProfile.avatar,\n        provider: 'wechat',\n        wechat_openid: normalizedProfile.id\n      });\n    } catch (jwtError) {\n      console.error('âŒ JWT í† í° ìƒì„± ì˜¤ë¥˜:', jwtError);\n      const response = NextResponse.json(\n        { error: 'ì¸ì¦ í† í° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' },\n        { status: 500 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // 4. Supabaseì— ì‚¬ìš©ì ë°ì´í„° ì €ì¥ (ì„ íƒ ì‚¬í•­)\n    try {\n      // Supabase ì‚¬ìš©ìê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ (openId ê¸°ì¤€)\n      const { data: existingUsers } = await supabase\n        .from('user_profiles')\n        .select('id')\n        .eq('provider', 'wechat')\n        .eq('provider_id', normalizedProfile.id);\n      \n      if (existingUsers && existingUsers.length > 0) {\n        // ê¸°ì¡´ ì‚¬ìš©ìê°€ ìˆìœ¼ë©´ í”„ë¡œí•„ ì—…ë°ì´íŠ¸\n        const userId = existingUsers[0].id;\n        \n        await supabase.from('user_profiles').update({\n          display_name: normalizedProfile.name,\n          avatar_url: normalizedProfile.avatar,\n          updated_at: new Date().toISOString()\n        }).eq('id', userId);\n        \n        normalizedProfile.userId = userId;\n        console.log('âœ… ê¸°ì¡´ WeChat ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');\n      }\n    } catch (error) {\n      console.warn('âš ï¸ Supabase ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰):', error);\n      // ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰\n    }\n    \n    const processingTime = Date.now() - startTime;\n    console.log('âœ… WeChat API ì²˜ë¦¬ ì™„ë£Œ:', {\n      processingTime: `${processingTime}ms`,\n      openId: normalizedProfile.id.substring(0, 8) + '...' // ë³´ì•ˆìƒ ì¼ë¶€ë§Œ ë¡œê·¸\n    });\n    \n    const response = NextResponse.json({\n      success: true,\n      tokens: {\n        access_token: accessToken,\n        refresh_token: refreshToken,\n        expires_in: expiresIn,\n        id_token: idToken\n      },\n      profile: normalizedProfile,\n      metadata: {\n        processingTime,\n        timestamp: new Date().toISOString()\n      }\n    });\n    \n    // ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… í—¤ë” ì¶”ê°€\n    response.headers.set('X-RateLimit-Limit', RATE_LIMIT_MAX_REQUESTS.toString());\n    response.headers.set('X-RateLimit-Remaining', rateLimitResult.remaining.toString());\n    response.headers.set('X-RateLimit-Reset', rateLimitResult.resetTime.toString());\n    \n    return setSecurityHeaders(response);\n    \n  } catch (error) {\n    const processingTime = Date.now() - startTime;\n    console.error('âŒ WeChat API ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', {\n      error: error instanceof Error ? error.message : String(error),\n      stack: error instanceof Error ? error.stack : undefined,\n      processingTime: `${processingTime}ms`\n    });\n    \n    const response = NextResponse.json(\n      { \n        error: 'ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',\n        timestamp: new Date().toISOString()\n      },\n      { status: 500 }\n    );\n    \n    return setSecurityHeaders(response);\n  }\n}\n\n/**\n * WeChat í† í° ê°±ì‹  API\n */\nexport async function PUT(request: NextRequest) {\n  const startTime = Date.now();\n  \n  try {\n    // í´ë¼ì´ì–¸íŠ¸ IP ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° (ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…ìš©)\n    const clientIp = request.headers.get('x-forwarded-for') || \n                     request.headers.get('x-real-ip') || \n                     'unknown';\n    \n    console.log('ğŸ” WeChat í† í° ê°±ì‹  ìš”ì²­ ì‹œì‘:', {\n      ip: clientIp,\n      timestamp: new Date().toISOString()\n    });\n    \n    // ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… ê²€ì‚¬\n    const rateLimitResult = checkRateLimit(clientIp);\n    if (!rateLimitResult.allowed) {\n      console.warn('âš ï¸ í† í° ê°±ì‹  ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ì´ˆê³¼:', { ip: clientIp });\n      \n      const response = NextResponse.json(\n        { \n          error: 'ìš”ì²­ì´ ë„ˆë¬´ ìì£¼ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',\n          retryAfter: Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000)\n        },\n        { status: 429 }\n      );\n      \n      response.headers.set('Retry-After', Math.ceil((rateLimitResult.resetTime - Date.now()) / 1000).toString());\n      return setSecurityHeaders(response);\n    }\n    \n    // ìš”ì²­ ë³¸ë¬¸ íŒŒì‹±\n    let requestBody;\n    try {\n      requestBody = await request.json();\n    } catch (parseError) {\n      console.error('âŒ í† í° ê°±ì‹  ìš”ì²­ ë³¸ë¬¸ íŒŒì‹± ì˜¤ë¥˜:', parseError);\n      const response = NextResponse.json(\n        { error: 'ì˜ëª»ëœ JSON í˜•ì‹ì…ë‹ˆë‹¤.' },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    const { refresh_token } = requestBody;\n    \n    // ì…ë ¥ ê²€ì¦\n    if (!refresh_token || typeof refresh_token !== 'string') {\n      const response = NextResponse.json(\n        { error: 'ë¦¬í”„ë ˆì‹œ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.' },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    if (refresh_token.length < 10 || refresh_token.length > 512) {\n      const response = NextResponse.json(\n        { error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ë¦¬í”„ë ˆì‹œ í† í° í˜•ì‹ì…ë‹ˆë‹¤.' },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // WeChat API ì„¤ì •\n    const appId = process.env.NEXT_PUBLIC_WECHAT_APP_ID;\n    \n    if (!appId) {\n      console.error('âŒ WeChat ì•± ID í™˜ê²½ ë³€ìˆ˜ ëˆ„ë½');\n      const response = NextResponse.json(\n        { error: 'WeChat ì„œë¹„ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' },\n        { status: 500 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    console.log('ğŸ” WeChat í† í° ê°±ì‹  API í˜¸ì¶œ');\n    \n    // í† í° ê°±ì‹  ìš”ì²­\n    const refreshUrl = `https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=${encodeURIComponent(appId)}&grant_type=refresh_token&refresh_token=${encodeURIComponent(refresh_token)}`;\n    \n    let refreshResponse;\n    try {\n      refreshResponse = await fetch(refreshUrl, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n          'User-Agent': 'WeChat-OAuth-Server/1.0'\n        },\n        // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)\n        signal: AbortSignal.timeout(10000)\n      });\n    } catch (fetchError) {\n      console.error('âŒ WeChat í† í° ê°±ì‹  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', fetchError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' },\n        { status: 503 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    if (!refreshResponse.ok) {\n      console.error('âŒ WeChat í† í° ê°±ì‹  HTTP ì˜¤ë¥˜:', {\n        status: refreshResponse.status,\n        statusText: refreshResponse.statusText\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: 'WeChat í† í° ê°±ì‹  ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',\n          details: `HTTP ${refreshResponse.status}: ${refreshResponse.statusText}`\n        },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    let refreshData;\n    try {\n      refreshData = await refreshResponse.json();\n    } catch (parseError) {\n      console.error('âŒ WeChat í† í° ê°±ì‹  ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜:', parseError);\n      const response = NextResponse.json(\n        { error: 'WeChat ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },\n        { status: 502 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    // WeChat API ì˜¤ë¥˜ ì²˜ë¦¬\n    if (refreshData.errcode) {\n      const errorMessage = handleWeChatApiError(refreshData.errcode, refreshData.errmsg);\n      console.error('âŒ WeChat í† í° ê°±ì‹  API ì˜¤ë¥˜:', {\n        errcode: refreshData.errcode,\n        errmsg: refreshData.errmsg,\n        friendlyMessage: errorMessage\n      });\n      \n      const response = NextResponse.json(\n        { \n          error: errorMessage,\n          code: refreshData.errcode\n        },\n        { status: 400 }\n      );\n      return setSecurityHeaders(response);\n    }\n    \n    const processingTime = Date.now() - startTime;\n    console.log('âœ… WeChat í† í° ê°±ì‹  ì™„ë£Œ:', {\n      processingTime: `${processingTime}ms`,\n      hasNewToken: !!refreshData.access_token\n    });\n    \n    const response = NextResponse.json({\n      success: true,\n      tokens: {\n        access_token: refreshData.access_token,\n        refresh_token: refreshData.refresh_token,\n        expires_in: refreshData.expires_in,\n        openid: refreshData.openid\n      },\n      metadata: {\n        processingTime,\n        timestamp: new Date().toISOString()\n      }\n    });\n    \n    return setSecurityHeaders(response);\n    \n  } catch (error) {\n    const processingTime = Date.now() - startTime;\n    console.error('âŒ WeChat í† í° ê°±ì‹  ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:', {\n      error: error instanceof Error ? error.message : String(error),\n      stack: error instanceof Error ? error.stack : undefined,\n      processingTime: `${processingTime}ms`\n    });\n    \n    const response = NextResponse.json(\n      { \n        error: 'ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',\n        timestamp: new Date().toISOString()\n      },\n      { status: 500 }\n    );\n    \n    return setSecurityHeaders(response);\n  }\n}\n\n/**\n * OPTIONS ìš”ì²­ ì²˜ë¦¬ (CORS preflight)\n */\nexport async function OPTIONS(request: NextRequest) {\n  const response = new NextResponse(null, { status: 200 });\n  return setSecurityHeaders(response);\n}\n\n/**\n * JWT í† í° ìƒì„± í•¨ìˆ˜\n * jsonwebtoken ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•œ í† í° ìƒì„±\n */\nasync function generateJwtToken(payload: any): Promise<string> {\n  // JWT ì‹œí¬ë¦¿ í‚¤ (í™˜ê²½ ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ ê¸°ë³¸ê°’ ì‚¬ìš©)\n  const jwtSecret = process.env.JWT_SECRET || \n                   process.env.SUPABASE_JWT_SECRET || \n                   process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \n                   'fallback-secret-key';\n  \n  if (jwtSecret === 'fallback-secret-key') {\n    console.warn('âš ï¸ JWT ì‹œí¬ë¦¿ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');\n  }\n  \n  const now = Math.floor(Date.now() / 1000);\n  const expiresIn = 3600; // 1ì‹œê°„\n  \n  const tokenPayload = {\n    ...payload,\n    iat: now,\n    exp: now + expiresIn,\n    iss: 'picnic-web-wechat',\n    aud: 'picnic-web',\n    jti: `wechat_${Date.now()}_${Math.random().toString(36).substring(2)}`\n  };\n  \n  try {\n    return jwt.sign(tokenPayload, jwtSecret, {\n      algorithm: 'HS256'\n    });\n  } catch (jwtError) {\n    console.error('âŒ JWT í† í° ìƒì„± ì‹¤íŒ¨:', jwtError);\n    throw new Error('JWT í† í° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n  }\n} "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}