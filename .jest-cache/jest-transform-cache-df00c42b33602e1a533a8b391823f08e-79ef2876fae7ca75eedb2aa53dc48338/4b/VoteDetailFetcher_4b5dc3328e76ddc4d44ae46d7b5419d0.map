{"version":3,"names":["cov_2ksp2g0kya","actualCoverage","s","VoteDetailFetcher","voteId","className","f","supabase","_server","createPublicSupabaseClient","numericVoteId","parseInt","isNaN","b","console","error","_navigation","notFound","data","vote","voteError","voteItems","itemsError","rewards","Promise","all","from","select","eq","single","order","ascending","Error","log","length","_jsxruntime","jsx","_HybridVoteDetailPresenter","HybridVoteDetailPresenter","initialItems","initialUser","initialUserVotes","enableRealtime","pollingInterval","maxRetries"],"sources":["/Users/cheolhyun/Repositories/picnic-web/components/server/vote/VoteDetailFetcher.tsx"],"sourcesContent":["import { notFound } from 'next/navigation';\nimport { HybridVoteDetailPresenter } from '@/components/client/vote/detail/HybridVoteDetailPresenter';\nimport { createPublicSupabaseClient } from '@/lib/supabase/server';\nimport { Vote, VoteItem } from '@/types/interfaces';\n\ninterface VoteDetailFetcherProps {\n  voteId: string;\n  className?: string;\n}\n\n/**\n * ν¬ν‘ μƒμ„Έ λ°μ΄ν„°λ¥Ό μ„λ²„μ—μ„ κ°€μ Έμ¤λ” μ»΄ν¬λ„νΈ (κ³µκ° λ°μ΄ν„°λ§)\n * μ‚¬μ©μ μΈμ¦ κ΄€λ ¨ λ°μ΄ν„°λ” ν΄λΌμ΄μ–ΈνΈμ—μ„ μ²λ¦¬ν•μ—¬ μ •μ  λ λ”λ§ μ§€μ›\n */\nexport async function VoteDetailFetcher({\n  voteId,\n  className,\n}: VoteDetailFetcherProps) {\n  // π”§ μ •μ  λ λ”λ§ μ§€μ›: κ³µκ° λ°μ΄ν„° μ „μ© ν΄λΌμ΄μ–ΈνΈ μ‚¬μ© (μΏ ν‚¤ μ—†μ)\n  const supabase = createPublicSupabaseClient();\n\n  try {\n    // voteIdλ¥Ό μ«μλ΅ λ³€ν™\n    const numericVoteId = parseInt(voteId, 10);\n    if (isNaN(numericVoteId)) {\n      console.error('Invalid vote ID:', voteId);\n      notFound();\n    }\n\n    // π€ κ³µκ° λ°μ΄ν„°λ§ μ„λ²„μ—μ„ μ΅°ν (μ •μ  λ λ”λ§ κ°€λ¥)\n    const [\n      { data: vote, error: voteError },\n      { data: voteItems, error: itemsError },\n      { data: rewards }\n    ] = await Promise.all([\n      // ν¬ν‘ μ •λ³΄ μ΅°ν (κ³µκ° λ°μ΄ν„°)\n      supabase\n        .from('vote')\n        .select('*')\n        .eq('id', numericVoteId)\n        .single(),\n\n      // ν¬ν‘ μ•„μ΄ν…λ“¤ μ΅°ν (κ³µκ° λ°μ΄ν„°)\n      supabase\n        .from('vote_item')\n        .select(`\n          *,\n          artist:artist_id (\n            id,\n            name,\n            image\n          )\n        `)\n        .eq('vote_id', numericVoteId)\n        .order('vote_total', { ascending: false }),\n\n      // λ¦¬μ›λ“ μ •λ³΄ μ΅°ν (κ³µκ° λ°μ΄ν„°)\n      supabase\n        .from('reward')\n        .select('*')\n        .eq('vote_id', numericVoteId)\n    ]);\n\n    if (voteError || !vote) {\n      console.error('Vote fetch error:', voteError);\n      notFound();\n    }\n\n    if (itemsError) {\n      console.error('Vote items fetch error:', itemsError);\n      throw new Error('Failed to fetch vote items');\n    }\n\n    console.log(`[VoteDetailFetcher] μ„λ²„ κ³µκ° λ°μ΄ν„° λ΅λ“ μ™„λ£: ${voteItems?.length || 0}κ° μ•„μ΄ν…`);\n\n    // β¨ ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ— κ³µκ° λ°μ΄ν„°λ§ μ „λ‹¬\n    // μ‚¬μ©μ μΈμ¦ μ •λ³΄μ™€ ν¬ν‘ μƒνƒλ” ν΄λΌμ΄μ–ΈνΈμ—μ„ μ²λ¦¬\n    return (\n      <HybridVoteDetailPresenter\n        vote={vote as Vote}\n        initialItems={(voteItems || []) as unknown as VoteItem[]}\n        rewards={rewards || []}\n        initialUser={null} // ν΄λΌμ΄μ–ΈνΈμ—μ„ λ΅λ“\n        initialUserVotes={[]} // ν΄λΌμ΄μ–ΈνΈμ—μ„ λ΅λ“\n        className={className}\n        enableRealtime={true}\n        pollingInterval={1000}\n        maxRetries={3}\n      />\n    );\n  } catch (error) {\n    console.error('VoteDetailFetcher error:', error);\n    notFound();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAkBE;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAAAA,cAAA,GAAAE,CAAA;;;;;;+BAJoB;;;;;;WAAAC,iBAAA;;;;;;;;kCAdG;;;kCACiB;;;kCACC;AAYpC,eAAeA,kBAAkB;EACtCC,MAAM;EACNC;AAAS,CACc;EAAA;EAAAL,cAAA,GAAAM,CAAA;EACvB;EACA,MAAMC,QAAA;EAAA;EAAA,CAAAP,cAAA,GAAAE,CAAA,OAAW,IAAAM,OAAA,CAAAC,0BAA0B;EAAA;EAAAT,cAAA,GAAAE,CAAA;EAE3C,IAAI;IACF;IACA,MAAMQ,aAAA;IAAA;IAAA,CAAAV,cAAA,GAAAE,CAAA,OAAgBS,QAAA,CAASP,MAAA,EAAQ;IAAA;IAAAJ,cAAA,GAAAE,CAAA;IACvC,IAAIU,KAAA,CAAMF,aAAA,GAAgB;MAAA;MAAAV,cAAA,GAAAa,CAAA;MAAAb,cAAA,GAAAE,CAAA;MACxBY,OAAA,CAAQC,KAAK,CAAC,oBAAoBX,MAAA;MAAA;MAAAJ,cAAA,GAAAE,CAAA;MAClC,IAAAc,WAAA,CAAAC,QAAQ;IACV;IAAA;IAAA;MAAAjB,cAAA,GAAAa,CAAA;IAAA;IAEA;IACA,MAAM,CACJ;MAAEK,IAAA,EAAMC,IAAI;MAAEJ,KAAA,EAAOK;IAAS,CAAE,EAChC;MAAEF,IAAA,EAAMG,SAAS;MAAEN,KAAA,EAAOO;IAAU,CAAE,EACtC;MAAEJ,IAAA,EAAMK;IAAO,CAAE,CAClB;IAAA;IAAA,CAAAvB,cAAA,GAAAE,CAAA,QAAG,MAAMsB,OAAA,CAAQC,GAAG,CAAC;IACpB;IACAlB,QAAA,CACGmB,IAAI,CAAC,QACLC,MAAM,CAAC,KACPC,EAAE,CAAC,MAAMlB,aAAA,EACTmB,MAAM;IAET;IACAtB,QAAA,CACGmB,IAAI,CAAC,aACLC,MAAM,CAAC;;;;;;;SAOP,EACAC,EAAE,CAAC,WAAWlB,aAAA,EACdoB,KAAK,CAAC,cAAc;MAAEC,SAAA,EAAW;IAAM;IAE1C;IACAxB,QAAA,CACGmB,IAAI,CAAC,UACLC,MAAM,CAAC,KACPC,EAAE,CAAC,WAAWlB,aAAA,EAClB;IAAA;IAAAV,cAAA,GAAAE,CAAA;IAED;IAAI;IAAA,CAAAF,cAAA,GAAAa,CAAA,UAAAO,SAAA;IAAA;IAAA,CAAApB,cAAA,GAAAa,CAAA,UAAa,CAACM,IAAA,GAAM;MAAA;MAAAnB,cAAA,GAAAa,CAAA;MAAAb,cAAA,GAAAE,CAAA;MACtBY,OAAA,CAAQC,KAAK,CAAC,qBAAqBK,SAAA;MAAA;MAAApB,cAAA,GAAAE,CAAA;MACnC,IAAAc,WAAA,CAAAC,QAAQ;IACV;IAAA;IAAA;MAAAjB,cAAA,GAAAa,CAAA;IAAA;IAAAb,cAAA,GAAAE,CAAA;IAEA,IAAIoB,UAAA,EAAY;MAAA;MAAAtB,cAAA,GAAAa,CAAA;MAAAb,cAAA,GAAAE,CAAA;MACdY,OAAA,CAAQC,KAAK,CAAC,2BAA2BO,UAAA;MAAA;MAAAtB,cAAA,GAAAE,CAAA;MACzC,MAAM,IAAI8B,KAAA,CAAM;IAClB;IAAA;IAAA;MAAAhC,cAAA,GAAAa,CAAA;IAAA;IAAAb,cAAA,GAAAE,CAAA;IAEAY,OAAA,CAAQmB,GAAG,CAAC;IAAwC;IAAA,CAAAjC,cAAA,GAAAa,CAAA,UAAAQ,SAAA,EAAWa,MAAA;IAAA;IAAA,CAAAlC,cAAA,GAAAa,CAAA,UAAU,SAAQ;IAEjF;IACA;IAAA;IAAAb,cAAA,GAAAE,CAAA;IACA,oBACE,IAAAiC,WAAA,CAAAC,GAAA,EAACC,0BAAA,CAAAC,yBAAyB;MACxBnB,IAAA,EAAMA,IAAA;MACNoB,YAAA;MAAe;MAAA,CAAAvC,cAAA,GAAAa,CAAA,UAAAQ,SAAA;MAAA;MAAA,CAAArB,cAAA,GAAAa,CAAA,UAAa,EAAE;MAC9BU,OAAA;MAAS;MAAA,CAAAvB,cAAA,GAAAa,CAAA,UAAAU,OAAA;MAAA;MAAA,CAAAvB,cAAA,GAAAa,CAAA,UAAW,EAAE;MACtB2B,WAAA,EAAa;MACbC,gBAAA,EAAkB,EAAE;MACpBpC,SAAA,EAAWA,SAAA;MACXqC,cAAA,EAAgB;MAChBC,eAAA,EAAiB;MACjBC,UAAA,EAAY;;EAGlB,EAAE,OAAO7B,KAAA,EAAO;IAAA;IAAAf,cAAA,GAAAE,CAAA;IACdY,OAAA,CAAQC,KAAK,CAAC,4BAA4BA,KAAA;IAAA;IAAAf,cAAA,GAAAE,CAAA;IAC1C,IAAAc,WAAA,CAAAC,QAAQ;EACV;AACF","ignoreList":[]}