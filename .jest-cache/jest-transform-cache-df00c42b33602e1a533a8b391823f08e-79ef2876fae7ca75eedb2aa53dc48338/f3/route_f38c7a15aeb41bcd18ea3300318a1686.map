{"version":3,"names":["GET","cov_2pm1syorki","f","s","OPTIONS","request","searchParams","URL","url","imageUrl","get","b","_server","NextResponse","json","error","status","allowedDomains","isAllowed","some","domain","hostname","includes","response","fetch","headers","signal","AbortSignal","timeout","ok","console","warn","statusText","message","retryAfter","contentType","imageBuffer","arrayBuffer","Error","name"],"sources":["/Users/cheolhyun/Repositories/picnic-web/app/api/proxy-image/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\n/**\n * Ïù¥ÎØ∏ÏßÄ ÌîÑÎ°ùÏãú API\n * Google Ïù¥ÎØ∏ÏßÄ 429 ÏóêÎü¨Î•º Ïö∞ÌöåÌïòÍ∏∞ ÏúÑÌï¥ ÏÑúÎ≤ÑÏóêÏÑú Ïù¥ÎØ∏ÏßÄÎ•º ÌîÑÎ°ùÏãúÌï©ÎãàÎã§.\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const imageUrl = searchParams.get('url');\n    \n    if (!imageUrl) {\n      return NextResponse.json(\n        { error: 'Ïù¥ÎØ∏ÏßÄ URLÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.' },\n        { status: 400 }\n      );\n    }\n    \n    // URL Í≤ÄÏ¶ù\n    try {\n      const url = new URL(imageUrl);\n      \n      // ÌóàÏö©Îêú ÎèÑÎ©îÏù∏Îßå ÌîÑÎ°ùÏãú\n      const allowedDomains = [\n        'googleusercontent.com',\n        'lh3.googleusercontent.com',\n        'graph.facebook.com',\n        'pbs.twimg.com',\n        'cdn.discordapp.com',\n        'avatars.githubusercontent.com'\n      ];\n      \n      const isAllowed = allowedDomains.some(domain => \n        url.hostname.includes(domain)\n      );\n      \n      if (!isAllowed) {\n        return NextResponse.json(\n          { error: 'ÌóàÏö©ÎêòÏßÄ ÏïäÏùÄ ÎèÑÎ©îÏù∏ÏûÖÎãàÎã§.' },\n          { status: 403 }\n        );\n      }\n    } catch (error) {\n      return NextResponse.json(\n        { error: 'Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ URLÏûÖÎãàÎã§.' },\n        { status: 400 }\n      );\n    }\n    \n    // Ïù¥ÎØ∏ÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞\n    const response = await fetch(imageUrl, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (compatible; PicnicBot/1.0)',\n        'Accept': 'image/*',\n        'Cache-Control': 'no-cache'\n      },\n      // ÌÉÄÏûÑÏïÑÏõÉ ÏÑ§Ï†ï\n      signal: AbortSignal.timeout(10000) // 10Ï¥à\n    });\n    \n    if (!response.ok) {\n      console.warn(`üñºÔ∏è [ImageProxy] Ïù¥ÎØ∏ÏßÄ Î°úÎî© Ïã§Ìå®: ${response.status} ${response.statusText} for ${imageUrl}`);\n      \n      // 429 ÏóêÎü¨Ïù∏ Í≤ΩÏö∞ ÌäπÎ≥Ñ Ï≤òÎ¶¨\n      if (response.status === 429) {\n        return NextResponse.json(\n          { \n            error: 'Too Many Requests', \n            message: 'Ïù¥ÎØ∏ÏßÄ ÏÑúÎ≤ÑÏóêÏÑú ÏöîÏ≤≠ Ï†úÌïúÏù¥ Î∞úÏÉùÌñàÏäµÎãàÎã§.',\n            retryAfter: response.headers.get('Retry-After') || '300'\n          },\n          { status: 429 }\n        );\n      }\n      \n      return NextResponse.json(\n        { error: `Ïù¥ÎØ∏ÏßÄ Î°úÎî© Ïã§Ìå®: ${response.status}` },\n        { status: response.status }\n      );\n    }\n    \n    const contentType = response.headers.get('content-type') || 'image/jpeg';\n    const imageBuffer = await response.arrayBuffer();\n    \n    // Ïù¥ÎØ∏ÏßÄ ÏùëÎãµ Î∞òÌôò\n    return new NextResponse(imageBuffer, {\n      status: 200,\n      headers: {\n        'Content-Type': contentType,\n        'Cache-Control': 'public, max-age=3600, s-maxage=86400', // 1ÏãúÍ∞Ñ Î∏åÎùºÏö∞Ï†Ä Ï∫êÏãú, 1Ïùº CDN Ï∫êÏãú\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'GET',\n        'Access-Control-Allow-Headers': 'Content-Type'\n      }\n    });\n    \n  } catch (error) {\n    console.error('üñºÔ∏è [ImageProxy] ÌîÑÎ°ùÏãú ÏóêÎü¨:', error);\n    \n    // ÌÉÄÏûÑÏïÑÏõÉ ÏóêÎü¨\n    if (error instanceof Error && error.name === 'TimeoutError') {\n      return NextResponse.json(\n        { error: 'Ïù¥ÎØ∏ÏßÄ Î°úÎî© ÏãúÍ∞Ñ Ï¥àÍ≥º' },\n        { status: 504 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Ïù¥ÎØ∏ÏßÄ ÌîÑÎ°ùÏãú Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.' },\n      { status: 500 }\n    );\n  }\n}\n\n// OPTIONS ÏöîÏ≤≠ Ï≤òÎ¶¨ (CORS)\nexport async function OPTIONS() {\n  return new NextResponse(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type'\n    }\n  });\n} "],"mappings":"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","ignoreList":[]}